function enter_keyword(t){"13"==t.keyCode&&$("#serach_user").click()}function get_user(t){var e=$("#search_data").val(),r=$("#search_role").val(),a=site_url+"accounts/get_info/";$.get(a,{page:t,search_data:e,search_role:r},function(t){$("#user_table_div").html(t)})}$("#search_role").on("onchange",function(){get_user(1)}),$("#serach_user").on("click",function(){get_user(1)}),$(".user_add_btn").on("click",function(){var t=['<tr class="user_record user_edit_status">',"    <td>",'       <input class="form-control u_username" placeholder="请输入用户名"/>',"   </td>","    <td>",'        <input class="form-control u_chname" placeholder="请输入姓名"/>',"   </td>","   <td>",'        <input class="form-control u_qq" placeholder="请输入QQ"/>',"    </td>","    <td>",'        <input class="form-control u_phone" placeholder="请输入联系电话"/>',"    </td>","    <td>",'        <input class="form-control u_email" placeholder="请输入邮箱"/>',"    </td>","    <td>",'        <select class="form-control u_role" style="width:90px">','            <option value="0">用户</option>','            <option value="1">管理员</option>',"        </select>","    </td>","    <td>",'        <button type="button" class="btn-xs user_cancel_btn">取消</button> ','        <button type="button" class="btn-info btn-xs user_save_btn">保存</button>','        <a href="###" title="编辑" class="dev_user_opera user_edit_btn"><span aria-hidden="true" class="glyphicon glyphicon-edit"></span></a>','        <a href="###" title="删除" class="dev_user_opera user_del_btn"><span aria-hidden="true" class="glyphicon glyphicon-remove-circle"></span></a>','       <a href="###" title="重置密码" class="dev_user_opera user_rest_btn"><span aria-hidden="true" class="glyphicon glyphicon-lock"></span></a>',"    </td>","</tr>"].join("");return $("#no_record_row").hide(),$("#user_table").prepend($(t)),!1}),$(".user_export_btn").on("click",function(){window.location.href=site_url+"accounts/export_data/"}),$(".user_import_btn").on("click",function(){$("#data_files").val(""),art.dialog({id:"bktips",title:"批量导入用户",lock:!0,width:560,content:$("#user_import_div").get(0)})}),$("#user_import_div").on("click",".import_btn",function(){var t=$("#data_files").val();t?$("#sumbit_import").click():$("#error_msg").text("请选择一个文件")}),$("#user_table_div").on("click",".user_save_btn",function(){var t=($(this),$(this).closest(".user_record")),e=t.attr("user_id"),r=$.trim(t.find(".u_username").val()),a=$.trim(t.find(".u_chname").val()),i=$.trim(t.find(".u_qq").val()),n=$.trim(t.find(".u_phone").val()),n=$.trim(t.find(".u_phone").val()),o=$.trim(t.find(".u_email").val()),s=$.trim(t.find(".u_role").val());if(!r.match(/^[A-Za-z0-9][A-Za-z0-9.]{2,18}[A-Za-z0-9]$/))return art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:"用户名包含数字、字母和点，长度在4-20个字符"}).time(2),t.find(".u_username").focus(),!1;if(!a.match(/^[\u4e00-\u9fa5a-zA-Z0-9_]{1,16}$/))return art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:"中文名只能包含数字、字母、中文汉字、下划线，长度在1-16个字符"}).time(2),t.find(".u_chname").focus(),!1;if(!i.match(/^[0-9]{5,13}$/))return art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:"QQ只能包含数字，长度在5-13个字符"}).time(2),t.find(".u_qq").focus(),!1;if(!n.match(/^\d{11}$/))return art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:"联系电话只能为11位数字"}).time(2),t.find(".u_phone").focus(),!1;if(!o.match(/^[A-Za-z0-9]+([-_.][A-Za-z0-9]+)*@([A-Za-z0-9]+[-.])+[A-Za-z0-9]{2,5}$/))return art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:"请输入正确的邮箱"}).time(2),t.find(".u_email").focus(),!1;if(!s)return art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:"请选择角色"}).time(2),t.find(".u_role").focus(),!1;if(e){var d=site_url+"accounts/save_user/";$.post(d,{user_id:e,username:r,chname:a,qq:i,phone:n,role:s,email:o},function(e,r){if("success"==r)if(e.result){art.dialog({id:"bktips",width:300,icon:"succeed",lock:!0,content:"保存成功"}).time(1),t.find("input").attr("disabled","disabled"),t.find("select").attr("disabled","disabled"),t.removeClass("user_edit_status");var a=$("#current_page").val();get_user(a)}else art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:e.msg});else art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:"保存失败"})},"json")}else{var d=site_url+"accounts/save_user/";$.post(d,{user_id:e,username:r,chname:a,qq:i,phone:n,role:s,email:o},function(e,r){"success"==r?e.result?(art.dialog({id:"bktips",width:300,icon:"succeed",lock:!0,content:"添加成功"}).time(1),user_data=e.data,t.attr("user_id",user_data),t.find("input").attr("disabled","disabled"),t.find("select").attr("disabled","disabled"),t.removeClass("user_edit_status"),get_user(1)):art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:e.msg}):art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:"添加失败"})},"json")}return!1}),$("#user_table_div").on("click",".user_edit_btn",function(){var t=$(this).closest(".user_record");t.addClass("user_edit_status"),t.find("input").removeAttr("disabled"),t.find("select").removeAttr("disabled");var e=$.trim(t.find(".u_username").val()),r=$.trim(t.find(".u_chname").val()),a=$.trim(t.find(".u_qq").val()),i=$.trim(t.find(".u_phone").val()),n=$.trim(t.find(".u_role").val()),o=$.trim(t.find(".u_email").val());return t.find(".u_username").attr("placeholder","请输入用户名"),t.find(".u_chname").attr("placeholder","请输入中文名"),t.find(".u_qq").attr("placeholder","请输入QQ"),t.find(".u_phone").attr("placeholder","请输入手机号"),t.find(".u_email").attr("placeholder","请输入邮箱"),t.attr("data-old-username",e),t.attr("data-old-chname",r),t.attr("data-old-qq",a),t.attr("data-old-phone",i),t.attr("data-old-role",n),t.attr("data-old-email",o),!1}),$("#user_table_div").on("click",".user_cancel_btn",function(){var t=$(this).closest(".user_record");t.removeClass("user_edit_status"),t.find("input").attr("disabled","disabled"),t.find("select").attr("disabled","disabled"),t.find(".u_username").attr("placeholder","--"),t.find(".u_chname").attr("placeholder","--"),t.find(".u_qq").attr("placeholder","--"),t.find(".u_phone").attr("placeholder","--"),t.find(".u_email").attr("placeholder","--");var e=t.attr("data-old-username"),r=t.attr("data-old-chname"),a=t.attr("data-old-qq"),i=t.attr("data-old-phone"),n=t.attr("data-old-role"),o=t.attr("data-old-email");e||r||a||i||o?(t.find(".u_username").val(e),t.find(".u_chname").val(r),t.find(".u_qq").val(a),t.find(".u_phone").val(i),t.find(".u_role").val(n),t.find(".u_email").val(o)):t.remove();var s=$("#user_table").find(".user_record").length;return 0==s&&$("#no_record_row").show(),!1}),$("#user_table_div").on("click",".user_del_btn",function(){var t=$(this).closest(".user_record"),e=t.attr("user_id"),r=t.find(".u_username").val();t.find(".u_chname").val();if(e){var a=site_url+"accounts/del_user/",i="<div class='t_s14'>您确定删除该用户吗?<br>用户名 : "+r+"</div>",n=340;art.dialog({title:"删除确认",width:n,icon:"question",lock:!0,content:i,ok:function(){art.dialog({id:"bktips",width:300,icon:"warning",lock:!0,content:"正在进行删除操作，请稍后..."}),$.post(a,{user_id:e,username:r},function(e){art.dialog({id:"bktips"}).close(),e.result?(art.dialog({id:"bktips",width:300,icon:"succeed",lock:!0,content:e.msg}).time(1),t.remove(),get_user(1)):art.dialog({id:"bktips",width:300,icon:"error",lock:!0,content:e.msg})},"json")},cancel:function(){},okVal:"确认删除",cancelVal:"取消"})}}),$("#user_table_div").on("click",".user_rest_btn",function(){$(".error_tip").hide(),$(".password_input").val(""),$("#password_tip").text("");var t=$(this).closest(".user_record"),e=t.attr("user_id");t.find(".u_username").val();art.dialog({id:"bkpwd",title:"重置密码",lock:!0,width:500,content:$("#change_password_div").get(0),cancelVal:"取消",cancel:function(){},okVal:"重置密码",ok:function(){var t=!0;if($(".error_tip").hide(),$("#pattern_tip").css("color","black"),$(".password_input").each(function(){var e=$.trim($(this).val());return e?e.match(/^[A-Za-z0-9!@#\$%\^\*\(\)-_\+=]{4,20}$/)||"password1"!=$(this).attr("name")?void 0:($("#pattern_tip").css("color","red"),$(this).focus(),t=!1,!1):($(this).next(".error_tip").show(),$(this).focus(),t=!1,!1)}),!t)return!1;var r=$.trim($("#id_password1").val()),a=$.trim($("#id_password2").val());if(r!=a&&($("#password_tip").text("两次输入的新密码不一致"),t=!1),!t)return!1;var i=site_url+"accounts/change_password/",n=!0;return $.ajax({type:"POST",url:i,data:{user_id:e,new_password1:r,new_password2:a},success:function(t){t.result||($("#password_tip").text(t.msg),n=!1)},dataType:"json",async:!1}),!!n&&void art.dialog({width:300,icon:"succeed",lock:!0,content:"密码重置成功"}).time(1)}})});