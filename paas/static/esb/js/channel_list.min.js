$(function(){function e(){var e;if((e=document.selection)&&e.empty)e.empty();else{window.getSelection&&window.getSelection().removeAllRanges();var n=document.activeElement;if(n){var t=n.nodeName.toLowerCase();("textarea"==t||"input"==t&&"text"==n.type)&&(n.selectionStart=n.selectionEnd)}}}$(".mymodal-backdrop").bind("click",function(){$("body").removeClass("menu-active"),$(".dropdown .dropdown-content").hide()}),$("#search_channel_system").select2();var n={get_selected_channel_ids:function(){var e=[];return $('input[name="channel_id"]:checked').each(function(n,t){e.push($(t).val())}),e}};$("#channels_delete").bind("click",function(){return channel_ids=n.get_selected_channel_ids(),0===channel_ids.length?void art.dialog({id:"bktips",icon:"warning",lock:!0,content:"请先选择待删除的通道！"}):void art.dialog({title:"删除确认",width:300,icon:"question",lock:!0,content:"该操作不可恢复，是否继续？",ok:function(){$.post(UrlMaker.make("channel_deleted"),{channel_ids:channel_ids.join(",")},function(e){e.error_message?art.dialog({id:"bktips",icon:"error",lock:!0,content:e.error_message}):(art.dialog({id:"bktips",icon:"succeed",lock:!0,content:"成功删除"+e.affected_rows+"个通道！"}).time(1),window.location.reload())})},cancel:function(){},okVal:"确认删除",cancelVal:"取消"})}),Handlebars.registerHelper("channel_edit_url",function(e){return UrlMaker.make("channel_edit",{channel_id:e})});var t=Backbone.Model.extend(),a=new t,c=Backbone.View.extend({el:"body",template:Handlebars.compile($("#tmpl_channel_list").html()),events:{"click #search_channel_btn":function(e){a.set({system_name:$("#search_channel_system").val(),channel_path:$("#search_channel_path").val(),channel_name:$("#search_channel_name").val()})},"click .show_esb_url":function(e){$("body").addClass("menu-active"),$("#"+e.target.id).parent(".dropdown").find(".dropdown-content").show()},"click .copy-to-clipboard":function(n){var t=n.currentTarget,a=$(t).parent().prev(),c=$(t).parent().find(".tooltip-inner");a[0].select();try{document.execCommand("copy"),c.text("已复制")}catch(e){c.text("复制失败，请手动复制")}e()},'change input[name="channel_id"]':function(e){target=$(e.target),target.is(":checked")?target.parents("tr").addClass("row-selected"):target.parents("tr").removeClass("row-selected")}},initialize:function(){this.listenTo(a,"change",this.render)},render:function(){var e=this.template;$.getJSON(UrlMaker.make("channel_list"),{system_name:a.get("system_name"),channel_path:a.get("channel_path"),channel_name:a.get("channel_name")},function(n){$("#table_channels").html(e(n)),$('[data-toggle="tooltip"]').tooltip()})}});new c;a.trigger("change")});